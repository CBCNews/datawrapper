

<div class="span4 visconfig">

    <div class="tab-container well">

        {# visualization specific options #}

        <div class="section refine">

            <h3>{% trans "Refine the chart" %}</h3>

            <div id="vis-options" class="form-horizontal">

                {% include 'chart/visualize/options.twig' %}

            </div>

            <div class="form-actions">
                <a class="btn submit btn-stepback" href="describe">
                    <i class="icon-chevron-left"></i> {% trans "Back" %}
                </a>
                <a href="#annotate" class="pull-right btn btn-primary proceed-btn">
                    {% trans "Annotate" %} <i class="icon-chevron-right icon-white"></i>
                </a>
            </div>
        </div>

        <div class="section annotate">

            <div class="story">
                <div class="story-title control-group">
                    <label class="separator">{% trans "Guide the audience to read the chart" %}</label>
                    <div class="pull-left">
                        <label for="text-title">{% trans "Title" %}</label>
                        <input type="text" id="text-title" class="input-xlarge span4" />

                        <label for="text-intro">{% trans "Description" %}</label>
                        <textarea type="text" id="text-intro" class="input-xlarge span4"></textarea>
                    </div>
                </div>

                {% include "chart/visualize/highlight.twig" %}

                {# {% include "chart/visualize/annotate.twig" %} #}

                {# repeat data source attribution one more time #}
                <div class="data-source control-group" style="clear:both">
                    <label class="separator">{% trans "Where did you get the data from?" %}</label>
                    <div class="pull-left">
                        <label>{% trans "Source name" %}</label>
                        <input id="describe-source-name" type="text" class="span2" placeholder="{% trans "name of the organisation" %}">
                    </div>
                    <div class="pull-left">
                        <label>{% trans "Source URL" %}</label>
                        <input id="describe-source-url" type="text" class="span2" placeholder="{% trans "URL of the dataset" %}">
                    </div>
                </div>

            </div>

            <div class="form-actions">
                <a class="btn submit btn-stepback" href="#refine">
                    <i class="icon-chevron-left"></i> {% trans "Back" %}
                </a>
                <a href="publish" class="submit pull-right btn btn-primary btn-lrge publish-btn" id="visualize-proceed">{% trans "Publish" %} <i class="icon-chevron-right icon-white"></i></a>
            </div>
        </div>

    </div>


    {% if debug %}

    {#

    The purpose of this section is to show a button labeled "store as test case", which
    calls the API and stores a kind of snapshot of the current chart configuration including
    data and a visual signature (or footprint if you like) for testing the chart in
    different browsers.

    It should never be visible on live instances

    #}

    <a href="#" class="snapshot btn btn-info">new test</a>
    <a href="#" class="snapshot update btn btn-info">update test</a>
    <script type="text/javascript">

    $(function() {
        var testId = dw.backend.currentChart.get('metadata.describe.__test_id', null);
        if (!testId) $('.snapshot.update').hide();

        $('.snapshot').click(function(e) {
            e.preventDefault();
            var vis = $('#iframe-vis').get(0).contentWindow.vis;
            var id = testId && $(e.target).hasClass('update') ? testId : prompt("Enter unique name for this test case..");
            $.ajax({
                type: 'POST',
                url: '/api/charts/{{ chart.id }}/store_snapshot',
                data: JSON.stringify({
                    id: id,
                    signature: vis.signature()
                }),
                dataType: 'json'
            }).done(function(res) {
                if (res.status == "ok") {
                    dw.backend.logMessage("The test case <b>"+id+"</b> has been "+(testId && $(e.target).hasClass('update') ? 'updated.' : 'created.'), '.visconfig');
                }
            });
        });
    });

    </script>

    {% endif %}

    <div class="clearfix"></div>
</div>
